name: Smoke SITREP


on:
  push:
    branches: [ main ]
    paths-ignore:
      - 'README.md'
      - 'docs/**'
  pull_request:
    branches: [ main ]
    paths-ignore:
      - 'README.md'
      - 'docs/**'
  workflow_dispatch:

permissions:
  contents: read
  # Minimal permissions for Smoke SITREP workflow; restrict GITHUB_TOKEN to read-only
  # See https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github_token
  # Do not remove unless workflow requires write access
  # Copilot Autofix: actions/missing-workflow-permissions

jobs:
  sitrep:
    runs-on: ubuntu-latest
    permissions:
      actions: read
      contents: read
      pull-requests: read
      checks: read
      statuses: read
      issues: read
    concurrency:
      group: ${{ github.workflow }}-${{ github.ref }}
      cancel-in-progress: true
    if: >-
      ${{ !contains(github.event.head_commit.message, '[skip-ci]')
          && (github.event_name != 'pull_request' || !contains(join(github.event.pull_request.labels.*.name), 'docs-only')) }}
    steps:
      - name: Checkout
        uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5

      - name: Smoke sg sitrep --dry-run
        run: |
          chmod +x scripts/sg
          ./scripts/sg sitrep --dry-run
